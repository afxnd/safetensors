# CryptoTensor 产品上下文

## 为什么需要这个项目

Safetensor文件格式高性能的实现了安全性（防止恶意代码执行漏洞），但是Safetensor并没有实现模型文件的机密性、完整性、受控部署等功能，无法直接在如机密计算等场景进行使用。

1. 机密性
   - 以Tensor为粒度只对Tensor数据进行加密保护，从而保证不会失去Safetensor懒加载、部分加载等特性
   - 不同Tensor的加密密钥不同
   - 允许只对部分Tensor数据进行加密
   - 支持密钥轮换和更新
   - 支持多种加密算法选择

2. 完整性
   - 对文件头通过签名实现完整性保护，保护Tensor加密元数据、受控部署策略不受篡改
   - 通过签名标识模型文件的拥有者
   - 支持证书链验证
   - 支持签名更新和撤销
   - 防重放攻击保护

3. 受控部署（当前不支持）
   - 基于Rego语言编写受控部署策略
   - 部署时会将基于完整性保护的文件头发送给Key Manager Service请求密钥，KMS验证策略通过后释放主密钥
   - CryptoTensor Core会同样验证部署策略，验证通过后进行解码
   - 支持细粒度的访问控制
   - 支持策略动态更新

## 解决的问题

1. 模型文件防窃取
   - 保护模型知识产权
   - 防止未授权访问
   - 支持访问审计
   - 支持使用追踪

2. 模型文件防篡改
   - 确保模型完整性
   - 防止恶意修改
   - 支持版本控制
   - 支持回滚机制

3. 模型文件受控部署
   - 基于策略的访问控制
   - 支持多租户部署
   - 支持使用限制
   - 支持计费集成

## 用户体验目标

1. 易用性与兼容性
   - 与原Safetensor的API完全兼容
   - 用户从Safetensor向CryptoTensor进行迁移时，不需要修改任何业务代码
   - 安装了CryptoTensor后可以无感加载无保护的Safetensor文件
   - 兼容Safetensor文件格式，可以直接上传到Huggingface
   - 提供详细的迁移指南
   - 提供示例代码和最佳实践

2. 高性能
   - 支持懒加载、部分加载，支持分布式场景
   - Memory footprint低，尽可能避免了内存拷贝
   - 加载无保护的Safetensor无性能损失
   - 支持硬件加速
   - 支持并行处理
   - 提供性能监控工具

## 主要使用场景

1. 模型安全本地部署
   - 用户出于安全考虑要求模型本地部署
   - 模型提供商为了防止模型被窃取并实现授权部署
   - 提供CryptoTensor文件
   - 用户在受信任的隔离环境中加载模型并运行推理服务
   - 支持访问控制和审计

2. 模型分发和共享
   - 安全的模型分发渠道
   - 受控的模型共享机制
   - 支持使用追踪和计费
   - 支持多租户部署

3. 机密计算环境
   - 支持在TEE中安全运行
   - 保护模型知识产权
   - 确保计算过程的安全性
   - 支持远程认证

## 用户故事

1. 模型提供商
   - 作为模型提供商，我希望能够安全地分发我的模型
   - 作为模型提供商，我希望能够控制模型的使用
   - 作为模型提供商，我希望能够追踪模型的使用情况

2. 模型使用者
   - 作为模型使用者，我希望能够安全地使用加密的模型
   - 作为模型使用者，我希望能够获得良好的性能
   - 作为模型使用者，我希望能够方便地集成到现有系统

3. 系统管理员
   - 作为系统管理员，我希望能够管理密钥和策略
   - 作为系统管理员，我希望能够监控系统使用情况
   - 作为系统管理员，我希望能够处理安全事件

## 性能指标

1. 加载性能
   - 加密模型加载时间 < 原始模型加载时间的1.3倍
   - 内存使用 < 原始模型的1.1倍
   - 支持流式加载大型模型

2. 运行性能
   - 推理延迟增加 < 20%
   - 支持硬件加速
   - 支持并行处理

3. 安全性能
   - 密钥管理开销 < 5%
   - 签名验证开销 < 10%
   - 策略验证开销 < 15%

## 竞品分析

1. 优势
   - 完全兼容Safetensor
   - 细粒度的加密控制
   - 高性能设计
   - 灵活的部署策略

2. 劣势
   - 相对较新
   - 生态系统待完善
   - 工具链待丰富

3. 机会
   - 快速增长的市场需求
   - 缺乏成熟的解决方案
   - 技术优势明显

4. 威胁
   - 竞争对手快速跟进
   - 技术标准变化
   - 安全威胁演进